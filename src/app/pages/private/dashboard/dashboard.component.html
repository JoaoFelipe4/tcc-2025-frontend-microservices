<div class="dashboard-container">
  <!-- Error Message -->
  <div class="error-message" *ngIf="error">
    <div class="error-content">
      <span class="error-icon">âš ï¸</span>
      <span>{{ error }}</span>
      <button class="retry-btn" (click)="reloadData()">Tentar Novamente</button>
    </div>
  </div>

  <div class="dashboard-header">
    <h1>Dashboard do Paciente</h1>
    <p>Bem-vindo, {{ currentUser?.firstName }} {{ currentUser?.lastName }}!</p>
    <div class="patient-basic-info" *ngIf="patientData">
      <small class="patient-info-line">
        {{ getAge(patientData.dateOfBirth) }} anos â€¢ 
        {{ patientData.bloodType || 'Tipo sanguÃ­neo nÃ£o informado' }} â€¢ 
        CPF: {{ patientData.cpf || 'NÃ£o informado' }}
      </small>
      <small class="patient-info-line" *ngIf="patientData.dateOfBirth">
        Data de Nascimento: {{ formatDate(patientData.dateOfBirth) }}
      </small>
    </div>
  </div>

  <section class="stats-section">
    <h2>Resumo de SaÃºde</h2>
    <div class="stats-grid">
      <div class="stat-card" *ngFor="let stat of stats">
        <div class="stat-icon">{{ stat.icon }}</div>
        <div class="stat-info">
          <h3>{{ stat.title }}</h3>
          <p class="stat-value" *ngIf="!stat.loading">{{ stat.value }}</p>
          <div class="loading-skeleton" *ngIf="stat.loading">
            <div class="skeleton-line"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="dashboard-content">
    <!-- Left Column -->
    <div class="left-column">
      <section class="recent-activities">
        <h2>HistÃ³rico MÃ©dico Recente</h2>
        <div class="activities-list" *ngIf="recentActivities.length > 0; else noActivities">
          <div class="activity-item" *ngFor="let activity of recentActivities">
            <div class="activity-dot"></div>
            <div class="activity-content">
              <p class="activity-action">{{ activity.action }}</p>
              <span class="activity-time">{{ activity.time }}</span>
            </div>
          </div>
        </div>
        <ng-template #noActivities>
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <p>Nenhum histÃ³rico mÃ©dico registrado</p>
          </div>
        </ng-template>
      </section>

      <section class="medications-section" *ngIf="patientData?.medications?.length > 0">
        <h2>MedicaÃ§Ãµes Ativas</h2>
        <div class="medications-list">
          <div class="medication-item" *ngFor="let med of patientData.medications">
            <div class="medication-icon">ğŸ’Š</div>
            <div class="medication-info">
              <h4>{{ med.name }}</h4>
              <p>{{ med.dosage }} â€¢ {{ med.frequency }}</p>
            </div>
          </div>
        </div>
      </section>

      <section class="allergies-section" *ngIf="patientData?.allergies?.length > 0">
        <h2>Alergias</h2>
        <div class="allergies-list">
          <div class="allergy-item" *ngFor="let allergy of patientData.allergies">
            <div class="allergy-icon">âš ï¸</div>
            <span class="allergy-name">{{ allergy }}</span>
          </div>
        </div>
      </section>
    </div>

    <!-- Right Column -->
    <div class="right-column">
      <section class="quick-actions">
        <h2>AÃ§Ãµes RÃ¡pidas</h2>
        <div class="actions-grid">
          <button class="action-btn" (click)="viewMedications()">
            <span class="action-icon">ğŸ’Š</span>
            <span>Minhas MedicaÃ§Ãµes</span>
          </button>
          <button class="action-btn" (click)="viewMedicalHistory()">
            <span class="action-icon">ğŸ“‹</span>
            <span>HistÃ³rico MÃ©dico</span>
          </button>
          <button class="action-btn" (click)="updateProfile()">
            <span class="action-icon">ğŸ‘¤</span>
            <span>Atualizar Perfil</span>
          </button>
          <button class="action-btn" (click)="contactEmergency()" 
                  [disabled]="!patientData?.emergencyContact">
            <span class="action-icon">ğŸ†˜</span>
            <span>Contato de EmergÃªncia</span>
          </button>
        </div>
      </section>

      <section class="emergency-contact" *ngIf="patientData?.emergencyContact">
        <h2>Contato de EmergÃªncia</h2>
        <div class="contact-card">
          <div class="contact-icon">ğŸ‘¤</div>
          <div class="contact-info">
            <h4>{{ patientData.emergencyContact.name }}</h4>
            <p>{{ patientData.emergencyContact.relationship }}</p>
            <p class="contact-phone">{{ patientData.emergencyContact.phone }}</p>
          </div>
        </div>
      </section>

      <section class="insurance-info" *ngIf="patientData?.insuranceInfo">
        <h2>ConvÃªnio MÃ©dico</h2>
        <div class="insurance-card">
          <div class="insurance-icon">ğŸ¥</div>
          <div class="insurance-info">
            <h4>{{ patientData.insuranceInfo.provider }}</h4>
            <p>NÂº: {{ patientData.insuranceInfo.policyNumber }}</p>
            <p class="insurance-validity" [class.expired]="getInsuranceStatus() === 'Expirado'">
              VÃ¡lido atÃ©: {{ formatDate(patientData.insuranceInfo.validUntil) }}
            </p>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>Carregando dados do paciente...</p>
  </div>
</div>