<!-- src/app/pages/public/register/register.component.html -->
<div class="register-container">
  <div class="register-card">
    <h2>Criar Nova Conta</h2>
    
    <form (ngSubmit)="onSubmit()" #registerForm="ngForm">
      <!-- Seleção do Tipo de Usuário -->
      <div class="user-type-selector">
        <button 
          type="button" 
          class="type-btn" 
          [class.active]="userType === 'patient'"
          (click)="setUserType('patient')">
          <i class="fas fa-user"></i>
          <span>Paciente</span>
        </button>
        <button 
          type="button" 
          class="type-btn" 
          [class.active]="userType === 'doctor'"
          (click)="setUserType('doctor')">
          <i class="fas fa-user-md"></i>
          <span>Médico</span>
        </button>
      </div>

      <!-- Dados Básicos -->
      <div class="form-row">
        <div class="form-group">
          <label for="firstName">Nome:</label>
          <input
            type="text"
            id="firstName"
            name="firstName"
            [(ngModel)]="formData.firstName"
            required
            #firstName="ngModel"
            class="form-control"
            [class.error]="firstName.invalid && firstName.touched"
            placeholder="Seu nome">
          <div *ngIf="firstName.invalid && firstName.touched" class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            Nome é obrigatório.
          </div>
        </div>

        <div class="form-group">
          <label for="lastName">Sobrenome:</label>
          <input
            type="text"
            id="lastName"
            name="lastName"
            [(ngModel)]="formData.lastName"
            required
            #lastName="ngModel"
            class="form-control"
            [class.error]="lastName.invalid && lastName.touched"
            placeholder="Seu sobrenome">
          <div *ngIf="lastName.invalid && lastName.touched" class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            Sobrenome é obrigatório.
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input
          type="email"
          id="email"
          name="email"
          [(ngModel)]="formData.email"
          required
          email
          #email="ngModel"
          class="form-control"
          [class.error]="email.invalid && email.touched"
          placeholder="seu@email.com">
        <div *ngIf="email.invalid && email.touched" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          Email é obrigatório e deve ser válido.
        </div>
      </div>

      <div class="form-group">
        <label for="phone">Telefone:</label>
        <input
          type="tel"
          id="phone"
          name="phone"
          [(ngModel)]="formData.phone"
          required
          #phone="ngModel"
          class="form-control"
          [class.error]="phone.invalid && phone.touched"
          placeholder="+5511999999999">
        <div *ngIf="phone.invalid && phone.touched" class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          Telefone é obrigatório.
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="password">Senha:</label>
          <input
            type="password"
            id="password"
            name="password"
            [(ngModel)]="formData.password"
            required
            minlength="6"
            #password="ngModel"
            class="form-control"
            [class.error]="password.invalid && password.touched"
            placeholder="Mínimo 6 caracteres">
          <div *ngIf="password.invalid && password.touched" class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            Senha deve ter pelo menos 6 caracteres.
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmar Senha:</label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            [(ngModel)]="confirmPassword"
            required
            #confirmPwd="ngModel"
            class="form-control"
            [class.error]="confirmPwd.touched && confirmPassword !== formData.password"
            placeholder="Confirme sua senha">
          <div *ngIf="confirmPwd.touched && confirmPassword !== formData.password" class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            As senhas não coincidem.
          </div>
        </div>
      </div>

      <!-- Campos Específicos para Paciente -->
      <div *ngIf="userType === 'patient'" class="specific-fields">
        <h3>Dados do Paciente</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label for="cpf">CPF:</label>
            <input
              type="text"
              id="cpf"
              name="cpf"
              [(ngModel)]="patientData.cpf"
              required
              maxlength="14"
              #cpf="ngModel"
              class="form-control"
              [class.error]="cpf.invalid && cpf.touched"
              placeholder="000.000.000-00"
              (input)="formatCPF($event)">
            <div *ngIf="cpf.invalid && cpf.touched" class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              CPF é obrigatório.
            </div>
          </div>

          <div class="form-group">
            <label for="dateOfBirth">Data de Nascimento:</label>
            <input
              type="date"
              id="dateOfBirth"
              name="dateOfBirth"
              [(ngModel)]="patientData.dateOfBirth"
              required
              #dateOfBirth="ngModel"
              class="form-control"
              [class.error]="dateOfBirth.invalid && dateOfBirth.touched">
            <div *ngIf="dateOfBirth.invalid && dateOfBirth.touched" class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              Data de nascimento é obrigatória.
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="bloodType">Tipo Sanguíneo:</label>
          <select
            id="bloodType"
            name="bloodType"
            [(ngModel)]="patientData.bloodType"
            required
            #bloodType="ngModel"
            class="form-control"
            [class.error]="bloodType.invalid && bloodType.touched">
            <option value="">Selecione...</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
          </select>
          <div *ngIf="bloodType.invalid && bloodType.touched" class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            Tipo sanguíneo é obrigatório.
          </div>
        </div>
      </div>

      <!-- Campos Específicos para Médico -->
      <div *ngIf="userType === 'doctor'" class="specific-fields">
        <h3>Dados Profissionais</h3>
        
        <div class="form-group">
          <label for="crm">CRM:</label>
          <input
            type="text"
            id="crm"
            name="crm"
            [(ngModel)]="doctorData.crm"
            required
            #crm="ngModel"
            class="form-control"
            [class.error]="crm.invalid && crm.touched"
            placeholder="CRM/UF 000000">
          <div *ngIf="crm.invalid && crm.touched" class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            CRM é obrigatório.
          </div>
        </div>

        <div class="form-group">
          <label>Especialidades:</label>
          <div class="specialties-container">
            <div class="specialty-input-group">
              <input
                type="text"
                [(ngModel)]="newSpecialty"
                name="newSpecialty"
                class="form-control"
                placeholder="Digite uma especialidade"
                (keyup.enter)="addSpecialty()">
              <button 
                type="button" 
                class="btn btn-add"
                (click)="addSpecialty()"
                [disabled]="!newSpecialty">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="specialties-list" *ngIf="doctorData.specialties.length > 0">
              <span 
                *ngFor="let specialty of doctorData.specialties; let i = index" 
                class="specialty-tag">
                {{ specialty }}
                <i class="fas fa-times" (click)="removeSpecialty(i)"></i>
              </span>
            </div>
            <div *ngIf="doctorData.specialties.length === 0" class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              Adicione pelo menos uma especialidade.
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="consultationPrice">Valor da Consulta (R$):</label>
            <input
              type="number"
              id="consultationPrice"
              name="consultationPrice"
              [(ngModel)]="doctorData.consultationPrice"
              required
              min="0"
              step="0.01"
              #consultationPrice="ngModel"
              class="form-control"
              [class.error]="consultationPrice.invalid && consultationPrice.touched"
              placeholder="0.00">
            <div *ngIf="consultationPrice.invalid && consultationPrice.touched" class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              Valor da consulta é obrigatório.
            </div>
          </div>

          <div class="form-group">
            <label for="consultationDuration">Duração (minutos):</label>
            <select
              id="consultationDuration"
              name="consultationDuration"
              [(ngModel)]="doctorData.consultationDuration"
              required
              #consultationDuration="ngModel"
              class="form-control"
              [class.error]="consultationDuration.invalid && consultationDuration.touched">
              <option value="">Selecione...</option>
              <option value="15">15 minutos</option>
              <option value="30">30 minutos</option>
              <option value="45">45 minutos</option>
              <option value="60">60 minutos</option>
            </select>
            <div *ngIf="consultationDuration.invalid && consultationDuration.touched" class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              Duração da consulta é obrigatória.
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="errorMessage" class="error-message server-error">
        <i class="fas fa-exclamation-triangle"></i>
        <span>{{ errorMessage }}</span>
      </div>

      <div *ngIf="successMessage" class="success-message">
        <i class="fas fa-check-circle"></i>
        <span>{{ successMessage }}</span>
      </div>

      <button
        type="submit"
        class="btn btn-primary btn-block"
        [disabled]="!isFormValid() || isLoading">
        <i class="fas fa-user-plus"></i>
        <span *ngIf="!isLoading">Criar Conta</span>
        <span *ngIf="isLoading">Criando conta...</span>
      </button>
      
      <div class="register-links">
        <a routerLink="/login"><i class="fas fa-sign-in-alt"></i> Já tenho uma conta</a>
      </div>
    </form>
  </div>
</div>